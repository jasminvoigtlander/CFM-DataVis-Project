<!-- Links -->
<link rel='stylesheet' type='text/css' href='dashboard.css' />
<link rel='stylesheet' type='text/css' href='data-upload.css' />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="sales.json"></script>
<script type="text/javascript" src="attendance.json"></script>

<div id='header'>
  <div class='content shadow radius-bottom'>
    <div class='padded'>
      <div class='outline'>
        <div class='logo-nav'>
          <div class='logo-nav'>
            <h1 id='logo'>
                <a href='https://cfmatl.org/'><img src='images/logo.png'>
            </h1>
          </div>
          <nav id='navigation'>
            <span class='menu-toggle'></span>
            <ul class='menu sf-arrows'>
              <li>
                <a class='sf-with-ul' href='dashboard.html'>Dashboard</a>
              </li>
              <li>
                <a class='sf-with-ul' href='graphs.html'>Graphs</a>
              </li>
              <li>
                <a class='sf-with-ul' href='data-upload.html'>Upload Data</a>
              </li>
              <li>
                <a class='sf-with-ul' href='support.html'>Support</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>
<div id='footer'>
  <div class='content shadow radius-top'>
    <div class='padded'>
      <div class='outline'>
        <div class='row'>
          <div class='upload-form'>
            <div class="toggle">
              <br>What data type are you uploading?</br>
              <div id="saleRadio">
                <input id="r1" class="form-radio" type="radio" name="graphs" value="SalesRadio" onchange="salesInputs()"> Sales<br>
              </div>
              <div id=attendanceRadio>
                <input id="r2" class="form-radio" type="radio" name="graphs" value="AttendanceRadio" onchange="attendanceInputs()"> Attendance<br>
              </div>
              <br>
            </div>
              <form id="data-form" hidden>
                <select id='markets' name='market' class='form-item' required>
                  <option value='' disable selected>Market</option>
                  <option value='EAV'>East Atlanta Village</option>
                  <option value='DFM-W'>Decatur (Wednesday)</option>
                  <option value='DFM-S'>Decatur (Saturday)</option>
                  <option value='GPFM'>Grant Park</option>
                  <option value='PCFM-S'>Poncy City</option>
                </select><br>

                <div id="vendorCategory">
                  <select  id='vc' name='vendorCategory' class='form-item' required>
                      <option value='' disable selected>Vendor Category</option>
                      <option value='farmer'>Farmer</option>
                      <option value='food'>Packaged, Processed and Prepared Food Vendor</option>
                      <option value='non-food'>Non-Food Vendor</option>
                    </select><br>
                </div>

                <div id="saleData">
                  <input name='sales' id='sales' class='form-item' placeholder='Sales' required><br>
                </div>
                <div id="attendanceData">
                  <input name='sales' id='attendance' class='form-item' placeholder='Attendance' required><br>
                </div>
                <input id='date' name='date' type ='date' class='form-item' required><br>
                <div class='button-container'>
                  <button type='button' class='primary-action' onclick="saveTo()">Upload Data</button>
                </div>
              </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="snackbar">Data Uploaded</div>
<script>
  //Prevent submit form default
  // $(".primary-action").click(function(event) {
  //   event.preventDefault();
  // });
  function salesInputs() {
      $("#data-form").show();
      var y = document.getElementById('attendanceData');
      y.style.display = "none";
      var x = document.getElementById('vendorCategory');
      x.style.display = "block";
      var z = document.getElementById('saleData');
      z.style.display = "block";
      var a = document.getElementById('vc');
      var b = document.getElementById('attendance');
      var c = document.getElementById('sales');
      a.required = true;
      b.required = false;
      c.required = true;
  }
  function attendanceInputs() {
    $("#data-form").show();
    var x = document.getElementById('vendorCategory');
    var y = document.getElementById('attendanceData');
    var z = document.getElementById('saleData');
    var a = document.getElementById('vc');
    var b = document.getElementById('attendance');
    var c = document.getElementById('sales');
    z.style.display = "none";
    c.required = false;
    x.style.display = "none";
    a.required = false;
    y.style.display = "block";
    b.required = true;
  }

  function saveTo() {
    var sale = document.getElementById('r1');
    var att = document.getElementById('r2');
    if (sale.checked) {
      console.log("SALE UPLOAD");
      if (document.getElementById('markets').options.selectedIndex !== 0 
        && document.getElementById('vc').options.selectedIndex 
        && document.getElementById('sales').value !== ''
        && document.getElementById('date').value !== '') {
          var market = document.getElementById('markets');
          var sm = market.options[market.selectedIndex].value;
          var vendor = document.getElementById('vc');
          var sv = vendor.options[vendor.selectedIndex].value;
          var dataNum = document.getElementById('sales').value;
          var date = document.getElementById('date').value;
          date = date.toString();
          date = reformatDate(date);
          dataNum = parseInt(dataNum);
          // console.log(sm);
          // console.log(sv);
          // console.log(dataNum);
          // console.log(date);
          // addSaleData(sm, sv, dataNum, date);

          var x = document.getElementById("snackbar");
          x.className = "show";
          setTimeout(function() { x.className = x.className.replace('show', ''); }, 3000);
        } else {
          alert('Please fill in all fields.');
        }
    } else if (att.checked) {
      console.log("ATTENDANCE UPLOAD");
      if (document.getElementById('markets').options.selectedIndex !== 0 
        && document.getElementById('attendance').value !== ''
        && document.getElementById('date').value !== '') {
          var market = document.getElementById('markets');
          var sm = market.options[market.selectedIndex].value;
          var dataNum = document.getElementById('attendance').value;
          var date = document.getElementById('date').value;
          date = date.toString();
          date = reformatDate(date);
          dataNum = parseInt(dataNum);
          // console.log(sm);
          // console.log(dataNum);
          // console.log(date.toString());
          // addAttendanceData(sm, dataNum, date);

          var x = document.getElementById("snackbar");
          x.className = "show";
          setTimeout(function() { x.className = x.className.replace('show', ''); }, 3000);
        } else {
          alert('Please fill in all fields.');
        }
    }
  }
  function reformatDate(dateString) {
    return dateString.substring(5, 7) + "/" + dateString.substr(8, 2) + "/" + dateString.substring(0, 4);
  }
  //
  //
  // function addSaleData(m, v, s, d) {
  //   $.getJSON("sales.json", function(json) {
  //
  //     var newSale = {
  //       timestamp: d,
  //       market: m,
  //       vendorCategory: v,
  //       sales: s,
  //       date: d,
  //       month: parseInt(d.substr(0,2)),
  //       day:  parseInt(d.substr(3,2)),
  //       year:  parseInt(d.substr(6,4)),
  //       high:"",
  //       low:"",
  //       precip:""
  //     };
  //
  //     json.push(newSale);
  //     console.log(json[json.length-1]);
  //     // console.log(JSON.stringify(json));
  //     postSale(JSON.stringify(json, null, '\t'));
  //
  //     // console.log(json[0]); // this will show the info it in firebug console
  //   });
  // }
  //
  // function postSale(sale) {
  //   // $.ajax({
  //   //   type: 'send',
  //   //   url: 'sales.json',
  //   //   data: sale,
  //   //   success: function() {
  //   //     console.log('djfhkajfhdsjhf');
  //   //   }
  //   // });
  // }
  //
  // function success() {
  //   console.log("yeeet");
  // }
  //
  // function addAttendanceData(m, a, d) {
  //   $.getJSON("attendance.json", function(json) {
  //     // console.log(json[0]); // this will show the info it in firebug console
  //   });
  //
  // }
  // Disable symbols and letters from Sales and Attendance input
  document.getElementById('sales').onkeypress = function(e) {
      var chr = String.fromCharCode(e.which);
      if ('1234567890'.indexOf(chr) < 0)
          return false;
  };
  document.getElementById('attendance').onkeypress = function(e) {
      var chr = String.fromCharCode(e.which);
      if ('1234567890'.indexOf(chr) < 0)
          return false;
  };
</script>
